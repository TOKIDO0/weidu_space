# 数据库迁移说明

## 重要：执行数据库迁移

在开始使用新功能之前，需要在 Supabase 数据库中执行以下迁移：

### 1. 添加 pinned 字段到 projects 表

如果您的 `projects` 表已经存在，需要执行以下 SQL 来添加 `pinned` 字段：

```sql
-- 在 Supabase SQL Editor 中执行
ALTER TABLE public.projects 
ADD COLUMN IF NOT EXISTS pinned boolean NOT NULL DEFAULT false;
```

或者直接执行迁移文件：
- 文件位置：`supabase/migration_add_pinned_to_projects.sql`
- 在 Supabase Dashboard → SQL Editor 中执行该文件内容

### 2. 如果是新项目

如果这是全新的项目，直接执行 `supabase/schema.sql` 即可，该文件已经包含了所有必要的表结构和字段。

## 功能说明

### 已完成的功能

1. **LOGO 位置调整** - 导航栏 LOGO 已向左移动
2. **项目展示关联数据库** - 前台作品展示从数据库读取，支持：
   - 编辑、删除、隐藏（发布/下架）、置顶
   - 按置顶、排序、创建时间排序
3. **客户评价关联数据库** - 前台评价从数据库读取，支持：
   - 编辑、删除、隐藏（审核通过/撤销）、置顶
   - 用户提交的评价默认待审核
4. **客户需求存储** - 用户提交的需求已存储到数据库，后台可查看和管理
5. **置顶功能** - 项目和评价都支持置顶，置顶内容会优先显示

### 数据流程

- **项目数据**：后台创建/编辑 → 数据库 → 前台展示（仅显示已发布的项目）
- **评价数据**：用户提交 → 数据库（待审核） → 后台审核通过 → 前台展示
- **客户需求**：用户提交 → 数据库 → 后台查看和管理

## 使用说明

### 后台管理

1. **项目管理** (`/projects`)
   - 创建新项目：填写项目信息，设置封面图和项目图片
   - 编辑项目：点击"编辑"按钮修改项目信息
   - 置顶项目：点击"置顶"按钮，置顶项目会优先显示
   - 发布/下架：控制项目是否在前台显示
   - 删除项目：永久删除项目

2. **评价管理** (`/reviews`)
   - 审核评价：用户提交的评价默认待审核，需要点击"通过"才会在前台显示
   - 置顶评价：重要评价可以置顶显示
   - 编辑评价：可以修改评价内容、评分等信息
   - 删除评价：删除不需要的评价

3. **客户需求管理** (`/leads`)
   - 查看所有客户提交的需求
   - 更新需求状态：new → contacted → done
   - 添加备注：记录跟进情况
   - 删除需求：清理不需要的需求

### 前台展示

- **作品展示**：自动从数据库加载已发布的项目，按置顶、排序、时间排序
- **客户评价**：自动从数据库加载已审核通过的评价，按置顶、时间排序
- **提交需求**：用户提交的需求会自动保存到数据库

## 注意事项

1. 确保 Supabase 数据库已正确配置
2. 确保 RLS（行级安全）策略已正确设置（见 `schema.sql`）
3. 前台页面需要 Supabase 客户端库已加载（已在 HTML 中包含）
4. 所有数据操作都会实时同步到数据库

