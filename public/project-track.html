<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>项目跟踪 - 维度空间设计</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&family=Outfit:wght@200;300;400;600&family=Syncopate:wght@400;700&display=swap');
    :root {
      --brand-orange: #ff4d00;
      --deep-bg: #050505;
      --glass-border: rgba(255, 255, 255, 0.08);
      --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
      --ease-smooth: cubic-bezier(0.25, 1, 0.5, 1);
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--deep-bg);
      color: #ffffff;
      overflow-x: hidden;
      min-height: 100vh;
    }
    /* Scrollbar */
    ::-webkit-scrollbar { width: 5px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--brand-orange); }

    /* Water Glass Card */
    .water-glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(24px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-top: 1px solid rgba(255, 255, 255, 0.3);
      border-left: 1px solid rgba(255, 255, 255, 0.3);
      padding: 30px;
      border-radius: 24px;
      transform-style: preserve-3d;
      transition: transform 0.1s linear;
      position: relative;
      box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.5),
        inset 0 0 40px rgba(255, 255, 255, 0.02);
    }

    /* Liquid Glass Button */
    .liquid-glass-btn {
      position: relative;
      overflow: hidden;
      padding: 10px 26px;
      border-radius: 100px;
      background: rgb(51, 51, 51);
      border: none;
      box-shadow: inset 0px 0px 16px 0px rgba(242, 242, 242, 1), 
                  inset 0px 0px 1px 1px rgba(153, 153, 153, 1), 
                  inset 0px 0px 1px 1px rgba(255, 255, 255, 0.15), 
                  inset -1px -1px 1px 0.5px rgba(255, 255, 255, 0.75), 
                  inset 1px 1px 1px 0.5px rgba(255, 255, 255, 0.75), 
                  inset 3px 3px 0.5px -3.5px rgba(255, 255, 255, 0.8), 
                  inset 3px 3px 0.5px -3.5px rgba(255, 255, 255, 0.75), 
                  0px 1px 8px 0px rgba(0, 0, 0, 0.1), 
                  0px 0px 2px 0px rgba(0, 0, 0, 0.1);
      background-image: linear-gradient(90deg, rgba(255, 255, 255, 1) 44%, rgba(0, 0, 0, 1) 83%);
      background-clip: text;
      -webkit-background-clip: text;
      color: transparent;
      font-family: 'SF Pro', 'Inter', sans-serif;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      text-align: center;
      width: 100%;
      letter-spacing: 4px;
    }
    .liquid-glass-btn:hover {
      opacity: 0.87;
      transform: translateY(-1px);
    }
    .liquid-glass-btn:active {
      transform: scale(0.95);
    }

    /* Reveal Animation */
    .reveal-blur {
      opacity: 0;
      filter: blur(20px);
      transform: translateY(40px);
      transition: all 1.2s cubic-bezier(0.16, 1, 0.3, 1);
      will-change: transform, opacity, filter;
    }
    .reveal-blur.active {
      opacity: 1;
      filter: blur(0);
      transform: translateY(0);
    }

    /* Input Style */
    .glass-input {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 14px 20px;
      border-radius: 12px;
      outline: none;
      transition: all 0.3s;
      width: 100%;
    }
    .glass-input:focus {
      border-color: var(--brand-orange);
      background: rgba(255, 255, 255, 0.05);
    }
    .glass-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* Progress Card */
    .progress-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(24px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body class="bg-neutral-950 text-neutral-200 antialiased selection:bg-orange-500 selection:text-white">

<!-- Background (component) added by Aura -->
<div class="aura-background-component fixed top-0 w-full h-screen -z-10" data-alpha-mask="80" style="mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent); -webkit-mask-image: linear-gradient(to bottom, transparent, black 0%, black 80%, transparent)"><div data-us-project="tCcBHRpF4pd3u3hQXCm5" class="absolute w-full h-full left-0 top-0 -z-10"></div>
<script type="text/javascript">
  !function(){if(!window.UnicornStudio){window.UnicornStudio={isInitialized:!1};var i=document.createElement("script");i.src="https://cdn.jsdelivr.net/gh/hiunicornstudio/unicornstudio.js@v1.4.34/dist/unicornStudio.umd.js",i.onload=function(){window.UnicornStudio.isInitialized||(UnicornStudio.init(),window.UnicornStudio.isInitialized=!0)},(document.head || document.body).appendChild(i)}}();
</script></div>

  <!-- Navbar -->
  <nav class="fixed top-0 left-0 right-0 z-50 border-b border-white/5 bg-neutral-950/70 backdrop-blur-xl">
    <div class="mx-auto flex max-w-7xl items-center justify-between px-6 py-4">
      <a href="index.html" class="flex items-center -ml-4">
        <img src="https://dl2.img.timecdn.cn/2025/12/10/LOGO.png" alt="WeiDU LOGO" class="h-8 w-auto">
      </a>
      <div class="hidden md:flex items-center space-x-8 text-xs font-['Syncopate'] uppercase tracking-widest text-neutral-400">
        <a href="index.html" class="hover:text-white transition-colors duration-300">首页</a>
        <a href="index.html#work" class="hover:text-white transition-colors duration-300">作品案例</a>
        <a href="index.html#philosophy" class="hover:text-white transition-colors duration-300">设计理念</a>
        <a href="index.html#testimonials" class="hover:text-white transition-colors duration-300">客户评价</a>
        <a href="project-track.html" class="hover:text-white transition-colors duration-300 text-white">项目跟踪</a>
        <a href="index.html#contact" class="hover:text-white transition-colors duration-300">联系我们</a>
      </div>
      <a href="index.html#contact" class="group relative inline-flex h-9 items-center justify-center overflow-hidden rounded-full p-[1px]">
        <span class="absolute inset-[-1000%] animate-[spin_2s_linear_infinite] bg-[conic-gradient(from_90deg_at_50%_50%,#171717_0%,#ff4d00_50%,#171717_100%)]"></span>
        <span class="inline-flex h-full w-full cursor-pointer items-center justify-center rounded-full bg-neutral-950 px-5 text-xs font-medium text-neutral-300 backdrop-blur-3xl transition-colors group-hover:text-white">
          <iconify-icon icon="solar:phone-linear" width="16" class="mr-2"></iconify-icon> 预约咨询
        </span>
      </a>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="min-h-screen pt-24 pb-12 px-4">
    <div class="max-w-4xl mx-auto">
      <div class="water-glass-card reveal-blur">
        <h1 class="text-4xl md:text-5xl font-medium text-white tracking-tight font-serif mb-4">
          项目进度查询
        </h1>
        <p class="text-neutral-400 mb-8 leading-relaxed">
          请输入您的手机号查询项目最新进度
        </p>

        <div class="mb-8">
          <label class="block text-xs uppercase tracking-wider text-neutral-500 mb-3 pl-1">手机号</label>
          <input
            type="tel"
            id="phoneInput"
            placeholder="请输入您的手机号"
            class="glass-input"
          />
          <button
            onclick="queryProgress()"
            class="mt-6 liquid-glass-btn"
          >
            查询进度
          </button>
        </div>

        <div id="progressContainer" class="hidden space-y-6 mt-8">
          <div id="progressList"></div>
        </div>

        <div id="noResult" class="hidden text-center py-12">
          <div class="text-neutral-400 text-lg mb-2">未找到相关项目进度</div>
          <p class="text-sm text-neutral-500">请确认手机号是否正确，或联系客服咨询</p>
        </div>

        <div class="mt-8">
          <a href="index.html" class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-neutral-900/50 border border-white/10 hover:bg-neutral-800 hover:border-orange-500/50 transition-all text-neutral-400 hover:text-white">
            <iconify-icon icon="solar:arrow-left-linear" width="20"></iconify-icon>
          </a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Supabase 配置
    const SUPABASE_URL = 'https://aitxgwfqtcrxxcglwmrq.supabase.co'
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpdHhnd2ZxdGNyeHhjZ2x3bXJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NDc1NTQsImV4cCI6MjA4MTIyMzU1NH0.OLDft-LmrRZEGEUEzJ9srevbnI68vV9jWf4Ym05lkAw'
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

    // Reveal animation
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('active')
        }
      })
    }, { threshold: 0.15 })
    document.querySelectorAll('.reveal-blur').forEach(el => revealObserver.observe(el))

    async function queryProgress() {
      const phone = document.getElementById('phoneInput').value.trim()
      if (!phone) {
        alert('请输入手机号')
        return
      }

      // 显示查询动画
      const container = document.getElementById('progressContainer')
      const noResult = document.getElementById('noResult')
      const progressList = document.getElementById('progressList')
      const waterGlassCard = document.querySelector('.water-glass-card')
      
      // 隐藏之前的结果
      container.classList.add('hidden')
      noResult.classList.add('hidden')
      
      // 在模态框内创建动画区域
      const animArea = document.createElement('div')
      animArea.id = 'queryAnimArea'
      animArea.className = 'mt-8 space-y-6 text-center'
      animArea.style.minHeight = '300px'
      animArea.innerHTML = `
        <div class="text-2xl font-semibold text-white animate-pulse" id="animText">正在整理库存...</div>
        <div class="w-16 h-16 mx-auto border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
        <div class="text-neutral-400 text-sm" id="animSubtext">从数据库查找您的项目...</div>
      `
      
      // 如果已经有动画区域，先移除
      const existingAnim = document.getElementById('queryAnimArea')
      if (existingAnim) existingAnim.remove()
      
      // 插入到模态框内
      if (waterGlassCard) {
        waterGlassCard.appendChild(animArea)
      }

      // 动画序列
      setTimeout(() => {
        const animTextEl = document.getElementById('animText')
        const animSubtextEl = document.getElementById('animSubtext')
        if (animTextEl) animTextEl.textContent = '从库里翻出一堆项目...'
        if (animSubtextEl) animSubtextEl.textContent = '正在整理项目信息...'
      }, 1500)

      try {
        // 先查询进度记录
        const { data: progressData, error: progressError } = await supabase
          .from('project_progress')
          .select('*')
          .eq('customer_phone', phone)
          .order('progress_date', { ascending: false })

        if (progressError) throw progressError

        // 获取所有项目ID
        const projectIds = [...new Set((progressData || []).map(p => p.project_id))]
        
        // 查询项目信息
        const { data: projectsData } = await supabase
          .from('projects')
          .select('id, title')
          .in('id', projectIds)

        // 合并数据
        const data = (progressData || []).map(progress => ({
          ...progress,
          projects: projectsData?.find(p => p.id === progress.project_id) || null
        }))

        // 等待动画完成后再显示结果
        setTimeout(() => {
          const animArea = document.getElementById('queryAnimArea')
          if (animArea) {
            // 移除动画区域
            animArea.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out'
            animArea.style.opacity = '0'
            animArea.style.transform = 'translateY(-20px)'
            setTimeout(() => animArea.remove(), 500)
          }

          if (!data || data.length === 0) {
            // 显示错误提示
            const animTextEl = document.getElementById('animText')
            if (animTextEl) {
              animTextEl.textContent = '抱歉~没有找到任何项目，或许是手机号错了？'
              animTextEl.className = 'text-xl font-semibold text-orange-400'
            }
            setTimeout(() => {
              container.classList.add('hidden')
              noResult.classList.remove('hidden')
              if (animArea) animArea.remove()
            }, 2000)
            return
          }

          // 更新动画文本
          const animTextEl = document.getElementById('animText')
          if (animTextEl) animTextEl.textContent = '您的项目在这里！'

          setTimeout(() => {
            container.classList.remove('hidden')
            noResult.classList.add('hidden')
            
            // 添加淡入动画
            container.style.opacity = '0'
            container.style.transform = 'translateY(20px)'
            container.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out'
            
            setTimeout(() => {
              container.style.opacity = '1'
              container.style.transform = 'translateY(0)'
            }, 100)

        const stageLabels = {
          design: '设计阶段',
          construction: '施工阶段',
          finishing: '收尾阶段',
          completed: '已完成'
        }

        // 按日期排序，最新的在前
        const sortedData = [...data].sort((a, b) => {
          const dateA = new Date(a.progress_date).getTime()
          const dateB = new Date(b.progress_date).getTime()
          return dateB - dateA
        })

        progressList.innerHTML = sortedData.map(progress => {
          const projectTitle = progress.projects?.title || '未知项目'
          const stageLabel = stageLabels[progress.stage] || progress.stage
          const progressDate = new Date(progress.progress_date).toLocaleDateString('zh-CN')

          let mediaHTML = ''
          if (progress.images && progress.images.length > 0) {
            mediaHTML += `
              <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mt-4">
                ${progress.images.map((img, idx) => `
                  <img 
                    src="${img}" 
                    alt="进度图片" 
                    class="w-full h-32 object-cover rounded-lg border border-white/10 cursor-pointer hover:scale-105 transition-transform duration-300" 
                    onclick="openImageModal('${img}')"
                    data-image-index="${idx}"
                  />
                `).join('')}
              </div>
            `
          }
          if (progress.videos && progress.videos.length > 0) {
            mediaHTML += `
              <div class="space-y-3 mt-4">
                ${progress.videos.map(video => `
                  <video src="${video}" controls class="w-full rounded-lg border border-white/10" preload="metadata"></video>
                `).join('')}
              </div>
            `
          }

          return `
            <div class="progress-card">
              <div class="flex items-start justify-between mb-4">
                <div>
                  <h3 class="text-xl font-semibold text-white mb-1">${progress.title}</h3>
                  <p class="text-sm text-neutral-400">${projectTitle}</p>
                </div>
                <span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-full text-xs font-semibold border border-orange-500/30">
                  ${stageLabel}
                </span>
              </div>
              <div class="text-sm text-neutral-400 mb-3">
                <span class="font-medium text-neutral-300">更新日期：</span>${progressDate}
              </div>
              ${progress.description ? `
                <div class="text-neutral-300 mb-4 whitespace-pre-wrap leading-relaxed">
                  ${progress.description}
                </div>
              ` : ''}
              ${mediaHTML}
            </div>
          `
        }).join('')
          }, 2000) // 在动画完成后显示
        }, 3000) // 总动画时间
      } catch (error) {
        console.error('查询失败:', error)
        // 移除动画区域
        const animArea = document.getElementById('queryAnimArea')
        if (animArea) {
          animArea.innerHTML = `
            <div class="text-xl font-semibold text-red-400">查询失败</div>
            <div class="text-neutral-400 text-sm">请检查网络连接或稍后重试</div>
          `
          setTimeout(() => animArea.remove(), 2000)
        }
      }
    }

    // 图片放大功能
    function openImageModal(imageSrc) {
      const modal = document.createElement('div')
      modal.id = 'imageModal'
      modal.className = 'fixed inset-0 z-[10000] flex items-center justify-center bg-black/90 backdrop-blur-md'
      modal.style.opacity = '0'
      modal.style.transition = 'opacity 0.3s ease-out'
      modal.innerHTML = `
        <div class="relative max-w-7xl max-h-[90vh] p-4">
          <img 
            src="${imageSrc}" 
            alt="放大图片" 
            class="max-w-full max-h-[90vh] object-contain rounded-lg"
            style="transform: scale(0.8); transition: transform 0.3s ease-out;"
          />
          <button 
            onclick="closeImageModal()" 
            class="absolute top-6 right-6 w-12 h-12 rounded-full bg-white/10 backdrop-blur-md border border-white/20 hover:bg-white/20 transition-all flex items-center justify-center text-white"
          >
            <iconify-icon icon="solar:close-circle-bold" width="24"></iconify-icon>
          </button>
        </div>
      `
      document.body.appendChild(modal)
      
      // 淡入动画
      setTimeout(() => {
        modal.style.opacity = '1'
        const img = modal.querySelector('img')
        if (img) img.style.transform = 'scale(1)'
      }, 10)
      
      // 点击背景关闭
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeImageModal()
      })
    }

    function closeImageModal() {
      const modal = document.getElementById('imageModal')
      if (modal) {
        const img = modal.querySelector('img')
        if (img) img.style.transform = 'scale(0.8)'
        modal.style.opacity = '0'
        setTimeout(() => modal.remove(), 300)
      }
    }

    // 支持回车查询
    document.getElementById('phoneInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        queryProgress()
      }
    })
  </script>
</body>
</html>
